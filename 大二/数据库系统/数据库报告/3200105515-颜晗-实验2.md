---
typora-root-url: 2image
typora-copy-images-to: 2image
---

<h1 align = "center">实验2  SQL数据定义和操作</h1>

**实验目的：**

1. 掌握关系数据库语言SQL的使用。

2. 使所有的SQL作业都能上机通过。

**实验平台：**

1. 数据库管理系统：MySQL

**实验内容和要求：**

1. 建立数据库。

2. 数据定义：表的建立/删除/修改;索引的建立/删除；视图的建立/删除

3. 数据更新：用insert/delete/update命令插入/删除/修改表数据。

4. 数据查询：单表查询，多表查询，嵌套子查询等。

5. 视图操作：通过视图的数据查询和数据修改

6. 所有的SQL作业都上机通过。

**实验过程：**

1. 建立新数据库：在标签页中写入以下代码并执行，刷新后看到新的空模式。

```sql
create schema testyh;
create database testyh;
#两者均可，在MySQL中效果相同
```

![image-20220405104429210](/image-20220405104429210.png)

2. 表的建立：执行代码并刷新。

```sql
use testyh;
create table classroom
	(building		varchar(15),
	 room_number		varchar(7),
	 capacity		numeric(4,0),
	 primary key (building, room_number)
	);
```

![image-20220405105142246](/image-20220405105142246.png)

3. 表的修改：增加/删除属性。依次执行增加、删除并看结果。

```sql
alter table classroom add number numeric(4,0);#增加number属性
alter table classroom drop column capacity;#删除capacity属性
```

![image-20220405105646301](/image-20220405105646301.png)



![image-20220405105723685](/image-20220405105723685.png)

4. 表的删除：执行代码后可见模式中已经无classroom的表了。

```sql
drop table classroom;
```

![image-20220405105919925](/image-20220405105919925.png)

5. 建立索引：先重新建好表，索引列中只有系统自动为primary key建立的索引。

![image-20220405110455606](/image-20220405110455606.png)

```sql
create index number on classroom(capacity);
```

![image-20220405111015175](/image-20220405111015175.png)![image-20220405111022708](/image-20220405111022708.png)



6. 索引删除：

```sql
drop index number on classroom; 
```

![image-20220405111243388](/image-20220405111243388.png)

7. 视图的建立：

```sql
create view see
as 
select room_number, capacity from classroom where building = 'Lamberton';
```

![image-20220405112121901](/image-20220405112121901.png)

8. 视图删除

```sql
drop view see;
```

![image-20220405112247881](/image-20220405112247881.png)

9. 向表中插入数据，执行选择语句，可以从跳出的界面中看到结果。

```sql
insert into classroom values('Lamberton', 134, 10);
insert into classroom values('Chandler', 375, 10);
insert into classroom values('Fairchild', 145, 27);
insert into classroom values('Nassau', 45, 92);
insert into classroom values('Grace', 40, 34);
insert into classroom values('Whitman', 134, 120);
insert into classroom values('Lamberton', 143, 10);
#插入语句
select * from classroom;
#选择语句
```

![image-20220405112544513](/image-20220405112544513.png)

10. 修改数据

```sql
update classroom set building ='Lamberton' where room_number=145;
#更新失败，安全模式？
update classroom set building ='Lamberton' where building ='Fairchild';
#更新成功
```

![image-20220405113933752](/image-20220405113933752.png)

11. 删除数据

```sql
delete from  classroom where building = 'Grace';
```

![image-20220405114200317](/image-20220405114200317.png)

12. 单表查询：

```sql
select room_number ,capacity
from classroom
where building = 'Lamberton';
```

![image-20220405114445541](/image-20220405114445541.png)



13. 多表查询：先建立多个表并插入数据。

```sql
#建立新的表
create table course
(	 name		 	varchar(20),
     building		varchar(15),
	 room_number	varchar(7),
 	 time			varchar(4),
	 primary key (name)
	);
insert into course values('C program','Lamberton', 134, 2);
insert into course values('physics','Chandler', 375, 4);
insert into course values('database','Fairchild', 145, 6);
insert into course values('ADS','Nassau', 45, 8);
insert into course values('fds','Grace', 40, 10);
insert into course values('OOP','Whitman', 134, 12);
insert into course values('ennnn','Lamberton', 143, 14);
```

```sql
#查询语句
select name,time
from classroom, course
where classroom.building = course.building and
	  classroom.room_number = course.room_number and
	  time > 8;
#由于Grace在第11步已经删除，表中只有两项数据。
```

![image-20220405133005990](/image-20220405133005990.png)



14. 嵌套子查询

```sql
select avg(capacity) as number
from (select name,S.building,capacity
      from course as S,classroom
      where classroom.building = S.building and
	  		classroom.room_number = S.room_number) 
            as T
where T.building = 'Lamberton';
#结果为最初两个Lamberton的容量的平均即10，后改的一个Lamberton由于房间号无法对上被筛去。
```

![image-20220405135029986](/image-20220405135029986.png)

15. 视图数据查询：先重新建立视图，再查询

```sql
create view seetime
as
select name,time from course ;#建立

select time from seetime;#查询
```

![image-20220405135812183](/image-20220405135812183.png)

16. 视图数据修改：在视图中修改后再从course中查询，执行后看到课程'C program'时间已经是11了。

```sql
update seetime
set time = 11
where name = 'C program';

select * from course;
```

![image-20220405140220392](/image-20220405140220392.png)







