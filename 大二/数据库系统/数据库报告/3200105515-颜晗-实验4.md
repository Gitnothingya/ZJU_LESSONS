---
typora-copy-images-to: 4image
typora-root-url: 4image
---

<h1 align = "center">实验4	SQL安全性</h1>

**实验目的：**

1.熟悉通过SQL进行数据完整性控制的方法。

**实验平台：**

1.数据库管理系统：MySQL 

**实验内容和要求：**

1.建立表，考察表的生成者拥有该表的哪些权限。

2.使用SQL 的grant 和revoke命令对其他用户进行授权和权力回收，考察相应的作用。

3.建立视图，并把该视图的查询权限授予其他用户，考察通过视图进行权限控制的作用。

**实验过程:**

1. 建立普通用户并连接。

```sql
#利用root用户建立普通用户，在root连接中执行如下代码
#语法：CREATE USER <user_name>@<host_name> identified BY <password>;
CREATE USER 'ordinary'@'localhost' IDENTIFIED BY '000000';
```

​	连接

![image-20220405222155483](/image-20220405222155483.png)

​	从左边空空如也的schema界面就可以看出新建的普通用户无法访问root的数据库。

![image-20220405222437101](/image-20220405222437101.png)

​	回到root用户的连接页面，为该普通用户授权。

```sql
#语法：GRANT priv_type ON [object_type] TO user;
GRANT select ON testyh.department TO 'ordinary'@'localhost';
#将数据库testyh的department表的选择权限向普通用户开放。
```

​	查看ordinary@localhost的权限

```sql
show grants for 'ordinary'@'localhost';#可用root查询也可用普通用户自身
```

![image-20220405223325917](/image-20220405223325917.png)

​	查看一下哪些用户有哪些在表department上的权限：

```sql
select * from mysql.tables_priv where table_name='department';#只能用root查询
```

![image-20220405223519525](/image-20220405223519525.png)

​	利用普通用户查询department表。

```sql
use testyh;
select * from department;
```

![image-20220405223754041](/image-20220405223754041.png)

​	从侧边栏的变化也可看出权限变化。有了department表但仍无student表。

![image-20220405223831339](/image-20220405223831339.png)

​	收回权限 

```sql
#语法：REVOKE priv_type ON [object_type] FROM user
REVOKE select ON testyh.department FROM 'ordinary'@'localhost';
```

​	再次从普通用户处查询，出现错误信息。

<font color='red'>22:40:29	select * from department LIMIT 0, 1000	Error Code: 1142. SELECT command denied to user 'ordinary'@'localhost' for table 'department'	0.000 sec</font>

2. 建立表，考察表的生成者拥有该表的哪些权限。

   ```sql
   #为普通用户授予建表的权限
   GRANT create ON testyh.* TO 'ordinary'@'localhost';
   #利用普通用户建立新表 test_table.
   use testyh;
   create table test_table(
   	id		char(8),
       name	varchar(10),
       primary key(id)
   );
   ```

   在root用户界面刷新后发现确实多了一个表。

![image-20220405225020809](/image-20220405225020809.png)

​	在普通用户的界面连表的名字都无法看到，说明普通用户只有建立的权限，其余的选择、更新权限一概没有。

![image-20220405225229269](/image-20220405225229269.png)

3. 授权与回收，参见步骤1.
4. 建立视图，并把该视图的查询权限授予其他用户，考察通过视图进行权限控制的作用。

```sql
#建立视图
create view see
as 
select name from student where dept_name = 'Music';

#授予普通用户对视图查询的权限
GRANT select ON testyh.see TO 'ordinary'@'localhost';

#利用普通用户查询视图
select * from see;

```

​	授权结果：

![image-20220405225905806](/image-20220405225905806.png)

​	查询结果：

![image-20220405225833756](/image-20220405225833756.png)
