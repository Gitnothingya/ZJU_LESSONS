---
typora-root-url: 5image
typora-copy-images-to: 5image
---

<h1 align = "center">实验5 图书管理程序</h1>

**一、实验目的**

1. 设计并实现一个精简的图书管理系统，具有图数入库、图书搜索、借书、还书、借书证管理
   等基本功能。
2. 通过本次设计来加深对数据库的了解和使用，同时提高自身的系统编程能力。

**二、实验平台**

1. 开发工具：Qt Creator 开源版；
2. 数据库平台：MySQL;

**三、总体设计**

1. 系统整体架构

​		该管理系统总共分为三大部分：图书管理、借书证管理、借阅信息管理三大部分；图书管理又分为搜索、借书、还书、单册书籍入库、多册书籍入库五项功能；借书证管理又包括注册、信息更新、注销三部分；借阅信息管理有借书证查询和书籍查询两种查询；其中，除图书搜索外，其余功能皆需要管理员登录才可进行，管理员由MySQL直接插入数据，暂未添加注册功能。

> ![QQ图片20220417203221](/QQ图片20220417203221.jpg)

各模块功能说明如下：

| <span style="display:inline-block;width:100px">模块名称</span>   | 功能描述             |
| :------------: | --------------------------------------------------- |
| 管理员登陆 | 根据输入的用户名和密码进行确认登录并添加窗口与修改权限       |
| 图书搜索   | 1. 共八项查询指标：书籍编号、书名、作者、出版年份、出版社、价位、类别;  2. 显示结果为所有查询指标的交集，如果未输入任何信息，则输出所有图书信息。 |
| 借书 | 1. 输入借书证号与书籍编号进行借阅；2. 输入错误（不存在）信息报错；3. 书库存为0时提示最早归还的日期。3. 借书成功则库存减1，且借书证的借书数量加1；4. 一张借书证不能多次借阅同一本书。 |
| 还书 | 1. 输入借书证号与书籍编号进行还书；2. 输入错误则弹出报错窗口；3. 还书成功则库存加1，而借书证借阅数量减1； |
| 单册入库 | 1. 输入书籍信息（书籍编号、书籍名称、类型、作者、价格、出版商、出版年份、存入量），其中书籍编号为必填项；2.如果书籍编号已存在，会根据填写信息对数据库中除库存和总量的信息进行更新（未填写则不更改）；3. 如果书籍编号不存在，则向数据库中插入新书籍。 |
| 多册入库 | 1. 文件格式：*.txt，一行对应一条图书信息，各个属性之间用 “/” 隔开，属性与单册入库须填信息同；2. 分别读入各条信息，插入数据库中，最后显示所有入库图书的信息。 |
| 借书证管理 | 1. 注册：输入借书证号，姓名、院系、身份（T，S）进行注册 ；如果该借书证号已存在，返回错误信息；成功则新增一项借书证数据 ；2.更新：输入同注册相同种类信息，其中借书证号为必填，之后对其余填写信息进行更新；3. 注销：删除一个借书证的信息。如果该借书证还有书籍未还，删除失败，返回错误信息。 |
| 借阅信息查询 | 根据输入的借书证号或书籍编号查询借阅信息。 |

2. 数据库表设计及E-R图

```sql
#数据库表
create table book(
	bno    char(6),				#书籍编号
    `name`   varchar(20),		#书籍名称
    category   varchar(20),		#类型
    author	varchar(10),		#作者
	price	numeric(6,2),		#价格
    stock 	int,				#库存
    pub		varchar(10),		#出版商
    pubyear int,				#出版年份
    total	int,				#总量
    primary key(bno)
);
create table card
(
	cno char(6),				#借书证编号
    `name` varchar(10),			#姓名
    department varchar(20),		#、院系
    privilege  char(1),			#身份，老师（T）或学生（S）
    borrowed    int,			#借书数量
    primary key(cno),
    check(privilege in('T','S'))
);
create table borrow
(
	cno char(6),				#借书证号
    cname varchar(10),			#借书人名
    bno char(6),				#书籍编号
    bname varchar(20),			#书籍名
    borrow_date varchar(12),	#借书日期
    return_date varchar(12),	#还书日期
    primary key(cno,bno),
    foreign key(cno) references card(cno),
    foreign key(bno) references book(bno)
);
create table manager
(
	username varchar(10),		#管理员用户名
    `password` varchar(20),		#管理员密码
    primary key (username)
);
```

E-R图

>![QQ图片20220417213301](/QQ图片20220417213301.jpg)

3. 开发技术说明。

   本次设计所使用开发技术可从两方面说明：MySQL，Qt 。
   

​	   MySQL 是一个免费开源的关系型数据库管理系统，同时具有 Workbench 这样图形化的界面，方便进行sql语句的执行与数据库管理。在开发过程中，可以先在MySQL中执行验证后调试程序，检查执行的语句，对照之下可较为简单的发现错误，也可对SQL语法进行熟悉。

​		Qt 是一个跨平台C++图形用户界面应用程序开发框架。Qt具有良好的封装机制，拥有诸多已经封装完善的类，方便进行数据库操作，图形界面设计。Qt信号与槽的优良机制使得程序的设计过程减少了许多阻碍。本次实验主要使用了QSqlDatabase 与QSqlQuery 两个类进行数据库连接与执行语句；使用QWidget, QPushBtton 等类进行图形界面的设计。

**四、详细设计与功能展示**

1. **主界面设计**

>登陆前，为游客身份，除图书管理界面，都不显示；左上角为登录按钮，注册按钮暂未实现功能。目前登录存在一个小问题，仅能使用下方的退出按钮进行退出，使用窗口自带的”叉“进行关闭会导致登录按钮不再可用。
>
>![image-20220417215720407](/image-20220417215720407.png)
>
>登陆后，新增借书证管理和借阅信息管理界面，点击即可进入对应界面。
>
>![image-20220417220112053](/image-20220417220112053.png)



​		需要提起的是，由于本人对于C++与Qt都处于一知半解的状态，本次设计仅建立了一个头文件与一个实现文件与主程序文件，也仅设计了唯一的一个类Widget，这样可以免去程序结构层次的设计，当然也增加查阅代码的难度。

​		Qt窗口界面的设计大同小异，且非本次设计的重点，在介绍中会大量略去。sql的查询实际也仅是字符串的拼接，逻辑很简单；因此主要展示操作结果。

​		以下为主窗口顶部设计，可代表所有窗口设计流程：1. 部件申请内存2. 为标签或编辑框等部件设定大小与文本；3. 建立垂直布局、水平布局、网格布局；4. 将按钮信号与槽函数关联起来； 5. 显示窗口，或将窗口添加到分页窗口中。 

```C++
void Widget::setTopTitle()
{
    QPalette palette;
    loginbutton = new QPushButton(tr("登录"));
    registerbutton = new QPushButton(tr("注册"));//两按钮
    userTypeLabel = new QLabel();
    newlineLabel = new QLabel("\n\n");
    vboxLayout0 = new QVBoxLayout();
    hboxLayout2 = new QHBoxLayout();
    hboxLayout3 = new QHBoxLayout();
    titleImage = new QWidget();
    mainWindow = new QWidget();
    vboxLayout3 = new QVBoxLayout();
    mainTabWidget = new QTabWidget();//布局与窗口初始化

    //登录注册按钮透明，大小固定
    registerbutton->setFlat(true);
    registerbutton->setFixedSize(QSize(60,30));
    loginbutton->setFlat(true);
    loginbutton->setFixedSize(QSize(60,30));

    //建立信号与槽
    //点击注册按钮，显示注册窗口
    connect(registerbutton,SIGNAL(clicked()),this,SLOT(setWindowRegister()));
    //点击登录按钮，显示登录窗口
    connect(loginbutton,SIGNAL(clicked()),this,SLOT(setWindowLogin()));

    //图片加载
    QDir d;
    titleImage->setAutoFillBackground(true);
    palette.setBrush(QPalette::Window,QBrush(QPixmap(d.currentPath()+"/top.jpg")));
    titleImage->setPalette(palette);
    titleImage->setLayout(hboxLayout2);

    //信息标签与按钮栏
    hboxLayout3->addWidget(userTypeLabel);
    hboxLayout3->addWidget(loginbutton);
    hboxLayout3->addWidget(registerbutton);

    vboxLayout3->addWidget(newlineLabel );
    vboxLayout3->addLayout(hboxLayout3);

    hboxLayout2->addStretch();
    hboxLayout2->addLayout(vboxLayout3 );


    //将标题图片和标签窗口加入总布局
    vboxLayout0->addWidget(titleImage);
    vboxLayout0->addWidget(mainTabWidget);

    mainWindow->setAutoFillBackground(true);
    mainWindow->setLayout(vboxLayout0);
    mainWindow->setWindowTitle(tr("颜晗的图书管理系统"));
    mainWindow->setFixedSize(960,620);

    mainWindow->show();
}
```

2. **图书入库**

   什么都没有的图书馆显然难以进行操作，我们先进行入库操作。

>1. 开始图书库中无任何书
>
>![image-20220417221742696](/image-20220417221742696.png)
>
>2. 进行单本插入
>
>![image-20220417222046060](/image-20220417222046060.png)
>
>3. 不输入任何信息直接点击搜索，即可出现插入书籍。点击表中某单元格，即可在左侧面板中出现书籍的完整信息。
>
>![image-20220417222220146](/image-20220417222220146.png)



​	



​		接下来进行多册图书入库操作。

>1. 这是使用的文件格式，文件存放在D盘根目录下
>
>![image-20220417222523988](/image-20220417222523988.png)
>
>2. 点击批量入库，在弹出窗口中输入路径。
>
>![image-20220417222639447](/image-20220417222639447.png)
>
>3. 文件导入成功后，会自动显示所有导入图书的信息。
>
>![image-20220417222803640](/image-20220417222803640.png)
>
>4. 从MySQL中进行查询验证
>
>![image-20220417223134237](/image-20220417223134237.png)

​		





​		验证书籍信息修改功能（已有对应书籍编号情况下）；

>1. 为方便从单本入库进行测试
>
>![image-20220417224234744](/image-20220417224234744.png)
>
>2. 可以看到，之前未填写的出版商被填上了，作者被改变了。
>
>![image-20220417224121724](/image-20220417224121724.png)
>
>3. MySQL验证
>
>   ![image-20220417225518824](/image-20220417225518824.png)

​		



3. **借书证管理**

   借书证无查询功能，表中会自动更新显示所有借书证信息。

>1. 借书证注册，原始表中空空，点击弹出窗口。
>
>![image-20220417224438457](/image-20220417224438457.png)
>
>2. 输入信息，新建一个借书证。
>
>![image-20220417224705257](/image-20220417224705257.png)
>
>3. 表中自动更新，点击表中单元格，侧边栏出现对应信息。可通过MySQL快速插入一些数据，便于后序测试；
>
>![image-20220417224758175](/image-20220417224758175.png)
>
>4. MySQL验证
>
>![image-20220417225618782](/image-20220417225618782.png)



​		



​		借书证修改。

>1. 点击更新按钮，在窗口中编辑。点击确认后弹出确认窗口。OK后进行修改。
>
>![image-20220417225252403](/image-20220417225252403.png)
>
>2. 更新后的表
>
>![image-20220417225320052](/image-20220417225320052.png)
>
>3. 需要注意的是，由于表只在该界面的操作后进行更新，如果在数据库中或其余界面中对表中数据进行了改变，是不会自动更新的，可以在更新窗口中输入一个借书证号后确认，即可不改变数据进行刷新操作。



​	



​		借书证注销

>1. 点击注销按钮，弹出对应窗口，编辑并确认后进行删除
>
>![image-20220417225734174](/image-20220417225734174.png)
>
>2. 表中自动更新，删除了该借书证
>
>![image-20220417225904037](/image-20220417225904037.png)
>
>3. MySQL验证
>
>![image-20220417225934323](/image-20220417225934323.png)



​		



​		在存在书籍未还的情况下，注销失败。

>1. 输入信息。
>
>![image-20220417230556980](/image-20220417230556980.png)
>
>2. 弹出出错信息。
>
>![image-20220417230622315](/image-20220417230622315.png)







4. **借/还书操作**（书籍中的时间由程序自动读取系统时间生成，还书日期由结束日期自动加30天）

   **普通借书操作。**

>1. 进行借书操作，输入信息并确认。
>
>![image-20220417231146463](/image-20220417231146463.png)
>
>2. 书库存减少
>
>![image-20220417231230818](/image-20220417231230818.png)
>
>3. 借书证管理中借阅数增加
>
>![image-20220417231316172](/image-20220417231316172.png)
>
>4. 借阅信息中出现对应信息。
>
>![image-20220417232059311](/image-20220417232059311.png)
>
>4. MySQL验证
>
>![image-20220417232250294](/image-20220417232250294.png)
>
>![image-20220417232303860](/image-20220417232303860.png)
>
>![image-20220417232320315](/image-20220417232320315.png)

​		



​	**同一个人不允许借多本相同的书。**

>![image-20220417232703054](/image-20220417232703054.png)
>
>

​		库存不足时，返回最先还书时间。（从MySQL手动修改插入数据，将C程序设计基础库存修改为0，由mike在2021-12-27日归还）

>1. 信息检查
>
>![image-20220417233328205](/image-20220417233328205.png)
>
>![image-20220417233404942](/image-20220417233404942.png)
>
>2. 借书尝试，失败
>
>![image-20220417233445930](/image-20220417233445930.png)





​		还书。

>1. 点击按钮，编辑信息。
>
>![image-20220417233613022](/image-20220417233613022.png)
>
>2. 信息查询，发现对应的借书信息被删除，库存与借书数量得到更新
>
>![image-20220417234311597](/image-20220417234311597.png)
>
>![image-20220417234328172](/image-20220417234328172.png)
>
>![image-20220417234512788](/image-20220417234512788.png)
>
>3. MySQL验证
>
>![image-20220417234538903](/image-20220417234538903.png)
>
>![image-20220417234553607](/image-20220417234553607.png)
>
>![image-20220417234604715](/image-20220417234604715.png)



**借阅信息查询**

>1. 整体表
>
>![image-20220417234749223](/image-20220417234749223.png)
>
>2. 借书证号查询
>
>![image-20220417234813615](/image-20220417234813615.png)
>
>3. 书籍号查询
>
>![image-20220417234847206](/image-20220417234847206.png)

